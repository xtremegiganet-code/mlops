name: ci-cd-final-project Lint and Test

on:
  push:
  pull_request:

jobs:
  lint-and-test:
    # --------------------
    # Container (shows container initialization logs)
    # --------------------
    runs-on: ubuntu-latest
    container:
      image: python:3.10-slim

    steps:
      # --------------------
      # Checkout code
      # --------------------
      - name: Checkout repository
        uses: actions/checkout@v3

      # --------------------
      # Show container info (explicit log visibility)
      # --------------------
      - name: Show container environment
        run: |
          echo "Running inside container:"
          python --version
          cat /etc/os-release

      # --------------------
      # Install dependencies
      # --------------------
      - name: Install Python packages
        run: |
          python -m pip install --upgrade pip
          pip install flake8 pytest

      # --------------------
      # Run flake8 lint
      # --------------------
      - name: Run flake8
        run: |
          echo "Starting flake8 linting..."
          flake8 .github/workflows/
          echo "Flake8 completed successfully."

      # --------------------
      # Run Python tests with pytest
      # --------------------
      - name: Run tests with pytest
        run: |
          echo "Starting unit tests..."
          pytest .github/workflows/tests -v --tb=short
          echo "Unit tests completed."

      # --------------------
      # Final success message
      # --------------------
      - name: Job completion message
        run: |
          echo "âœ… CI job completed successfully!"
